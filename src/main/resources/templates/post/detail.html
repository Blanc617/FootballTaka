<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" 
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/default}">

<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/style.css" type="text/css">
</head>

<body>
    <div id="wrap" class="container">
        <th:block th:replace="~{fragments/header :: header}"></th:block>
        
        <section class="contents d-flex justify-content-center" layout:fragment="contents">
        	<div class="post-box my-5" id="memoDetail" th:data-post-id="${memo.id}">
        		<h1 class="text-center">메모 상세</h1>
        		<input type="text" class="form-control mt-4" placeholder="제목을 입력하세요" id="titleInput" th:value="${memo.title}"  value="메모 제목입니다.">
        		<textarea class="form-control mt-2" rows="10" placeholder="내용을 입력하세요" id="contentsInput" th:text="${memo.contents}">메모 내용입니다.</textarea>
        		<img th:src="${memo.imagePath}">
        		<div class="d-flex justify-content-between mt-3">
        			<button type="button" class="btn btn-danger" id="deleteBtn">삭제</button>
        		
        			<div>
	        			<a href="/post/list-view" class="btn btn-secondary">목록으로</a>
	        			<button type="button" class="btn btn-secondary" id="saveBtn" >수정</button>
        			</div>
        		</div>
        	</div>
        </section>
        
        
       <script layout:fragment="script">
       		$(document).ready(function() {
       			
       			$("#deleteBtn").on("click", function() {
       				let id = $("#memoDetail").data("post-id");
       				
       				$.ajax({
       					type:"delete"
       					, url:"/post/delete"
       					, data:{"id":id}
       					, success:function(data) {
       						if(data.result == "success") {
       							location.href = "/post/list-view";
       						} else {
       							alert("삭제 실패!!");
       						}
       					}
       					, error:function() {
       						alert("삭제 에러!!");
       					}
       				});
       			});
       			
       			$("#saveBtn").on("click", function() {
       				let title = $("#titleInput").val();
       				let contents = $("#contentsInput").val();
       				
       				let id = $("#memoDetail").data("post-id");
       				
       				$.ajax({
       					type:"put"
       					, url:"/post/update"
       					, data:{"id":id, "title":title, "contents":contents}
       					, success:function(data) {
       						if(data.result == "success") {
       							location.reload();
       						} else {
       							alert("수정 실패!!");
       						}
       					}
       					, error:function() {
       						alert("수정 에러!!");
       					}
       				});
       			});
       			
       		});
       </script>            
        
        
        <th:block th:replace="~{fragments/footer :: footer}"></th:block>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>
    <th:block layout:fragment="script"></th:block>
    
</body>
</html>